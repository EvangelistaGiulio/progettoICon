incidente('http://example.org/incidente#img_157', normale, 0).
incidente('http://example.org/incidente#img_147', normale, 0).
incidente('http://example.org/incidente#img_143', normale, 0).
incidente('http://example.org/incidente#img_101', normale, 0).
incidente('http://example.org/incidente#img_162', normale, 0).
incidente('http://example.org/incidente#img_116', normale, 0).
incidente('http://example.org/incidente#img_103', normale, 0).
incidente('http://example.org/incidente#img_99', normale, 0).
incidente('http://example.org/incidente#img_24', normale, 0).
incidente('http://example.org/incidente#img_164', normale, 0).
incidente('http://example.org/incidente#img_96', normale, 0).
incidente('http://example.org/incidente#img_924', normale, 0).
incidente('http://example.org/incidente#img_25', normale, 3).
incidente('http://example.org/incidente#img_121', normale, 0).
incidente('http://example.org/incidente#img_134', normale, 0).
incidente('http://example.org/incidente#img_132', normale, 0).
incidente('http://example.org/incidente#img_123', normale, 0).
incidente('http://example.org/incidente#img_135', normale, 0).
incidente('http://example.org/incidente#img_133', normale, 0).
incidente('http://example.org/incidente#img_156', normale, 0).
incidente('http://example.org/incidente#img_925', normale, 0).
incidente('http://example.org/incidente#img_100', normale, 0).
incidente('http://example.org/incidente#img_28', normale, 0).
incidente('http://example.org/incidente#img_928', normale, 1).
incidente('http://example.org/incidente#img_105', normale, 0).
incidente('http://example.org/incidente#img_112', normale, 0).
incidente('http://example.org/incidente#img_106', normale, 0).
incidente('http://example.org/incidente#img_23', normale, 4).
incidente('http://example.org/incidente#img_128', normale, 0).
incidente('http://example.org/incidente#img_94', normale, 0).
incidente('http://example.org/incidente#img_117', normale, 0).
incidente('http://example.org/incidente#img_142', normale, 0).
incidente('http://example.org/incidente#img_87', normale, 0).
incidente('http://example.org/incidente#img_917', normale, 0).
incidente('http://example.org/incidente#img_916', normale, 0).
incidente('http://example.org/incidente#img_102', normale, 0).
incidente('http://example.org/incidente#img_125', normale, 0).
incidente('http://example.org/incidente#img_158', normale, 0).
incidente('http://example.org/incidente#img_145', normale, 0).
incidente('http://example.org/incidente#img_127', normale, 0).
incidente('http://example.org/incidente#img_95', normale, 0).
incidente('http://example.org/incidente#img_29', normale, 0).
incidente('http://example.org/incidente#img_138', normale, 0).
incidente('http://example.org/incidente#img_110', normale, 0).
incidente('http://example.org/incidente#img_155', normale, 0).
incidente('http://example.org/incidente#img_26', normale, 1).
incidente('http://example.org/incidente#img_118', normale, 0).
incidente('http://example.org/incidente#img_131', normale, 0).
incidente('http://example.org/incidente#img_136', normale, 0).
incidente('http://example.org/incidente#img_130', normale, 0).
incidente('http://example.org/incidente#img_120', normale, 0).
incidente('http://example.org/incidente#img_148', normale, 1).
incidente('http://example.org/incidente#img_159', normale, 0).
incidente('http://example.org/incidente#img_109', normale, 0).
incidente('http://example.org/incidente#img_152', normale, 0).
incidente('http://example.org/incidente#img_163', normale, 0).
incidente('http://example.org/incidente#img_146', normale, 0).
incidente('http://example.org/incidente#img_153', normale, 0).
incidente('http://example.org/incidente#img_140', normale, 0).
incidente('http://example.org/incidente#img_137', normale, 0).
incidente('http://example.org/incidente#img_150', normale, 0).
incidente('http://example.org/incidente#img_126', normale, 0).
incidente('http://example.org/incidente#img_27', normale, 0).
incidente('http://example.org/incidente#img_918', normale, 0).
incidente('http://example.org/incidente#img_129', normale, 0).
incidente('http://example.org/incidente#img_915', normale, 0).
incidente('http://example.org/incidente#img_144', normale, 0).
incidente('http://example.org/incidente#img_923', normale, 0).
incidente('http://example.org/incidente#img_108', normale, 0).
incidente('http://example.org/incidente#img_929', normale, 0).
incidente('http://example.org/incidente#img_149', normale, 0).
incidente('http://example.org/incidente#img_920', normale, 1).
incidente('http://example.org/incidente#img_98', normale, 0).
incidente('http://example.org/incidente#img_922', normale, 0).
incidente('http://example.org/incidente#img_104', normale, 0).
incidente('http://example.org/incidente#img_111', normale, 0).
incidente('http://example.org/incidente#img_921', normale, 0).
incidente('http://example.org/incidente#img_97', normale, 0).
incidente('http://example.org/incidente#img_151', normale, 0).
incidente('http://example.org/incidente#img_19', normale, 0).
incidente('http://example.org/incidente#img_22', normale, 4).
incidente('http://example.org/incidente#img_139', normale, 0).
incidente('http://example.org/incidente#img_927', normale, 0).
incidente('http://example.org/incidente#img_160', normale, 0).
incidente('http://example.org/incidente#img_165', normale, 0).
incidente('http://example.org/incidente#img_114', normale, 0).
incidente('http://example.org/incidente#img_113', normale, 0).
incidente('http://example.org/incidente#img_926', normale, 0).
incidente('http://example.org/incidente#img_21', normale, 0).
incidente('http://example.org/incidente#img_115', normale, 0).
incidente('http://example.org/incidente#img_141', normale, 0).
incidente('http://example.org/incidente#img_107', normale, 1).
incidente('http://example.org/incidente#img_119', normale, 0).
incidente('http://example.org/incidente#img_124', normale, 0).
incidente('http://example.org/incidente#img_20', normale, 0).
incidente('http://example.org/incidente#img_86', normale, 0).
incidente('http://example.org/incidente#img_919', normale, 0).
incidente('http://example.org/incidente#img_122', normale, 0).
incidente('http://example.org/incidente#img_154', normale, 0).
incidente('http://example.org/incidente#img_161', normale, 0).
ambulanza(a1).
ambulanza(a2).
ambulanza(a3).
ambulanza(a4).
ambulanza(a5).

% --- priorità per gravità ---
priorita(grave, 1).
priorita(normale, 2).

% --- ordina incidenti per priorità ---
ordina_incidenti_priorita(Incidenti, Ordinati) :-
    predsort(compara_incidenti, Incidenti, Ordinati).

compara_incidenti(Ord, incidente(_, G1, _), incidente(_, G2, _)) :-
    priorita(G1, P1),
    priorita(G2, P2),
    compare(Ord, P1, P2).

% --- seleziona N ambulanze dalla lista ---
seleziona_ambulanze(0, Amb, [], Amb).
seleziona_ambulanze(N, [A|As], [A|Sel], Resto) :-
    N > 0,
    N1 is N - 1,
    seleziona_ambulanze(N1, As, Sel, Resto).

% --- assegna ambulanze agli incidenti ---
assegna_ambulanze([], _, []).
assegna_ambulanze([incidente(Id, Grav, Feriti)|Rest], AmbDisp, [(Id, AmbAssegnate)|Assegnamenti]) :-
    (Feriti > 2 -> NumAmb = 2 ; NumAmb = 1),
    seleziona_ambulanze(NumAmb, AmbDisp, AmbAssegnate, NuoveAmbDisp),
    assegna_ambulanze(Rest, NuoveAmbDisp, Assegnamenti).

% --- predicato principale da chiamare per restituire tutta la lista ---
risolvi_assegnamento(Assegnamenti) :-
    findall(incidente(Id, Grav, Feriti), incidente(Id, Grav, Feriti), Incidenti),
    ordina_incidenti_priorita(Incidenti, IncidentiOrdinati),
    findall(A, ambulanza(A), Ambulanze),
    assegna_ambulanze(IncidentiOrdinati, Ambulanze, Assegnamenti).

% --- predicato per estrarre un assegnamento alla volta ---
assegnamento(IncidenteID, Ambulanze) :-
    risolvi_assegnamento(Assegnamenti),
    member((IncidenteID, Ambulanze), Assegnamenti).